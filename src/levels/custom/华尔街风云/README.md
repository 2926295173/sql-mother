# 华尔街风云

## 背景故事
你是"金牛投资"的量化分析师，牛市刚刚结束，公司积累了大量的股票交易数据。投资总监想要分析各支股票的表现，找出最佳投资策略。他把这个重要任务交给了你，希望你能从海量数据中挖掘出投资的黄金法则！

## 数据说明
我们有一个客户交易表 `client_transactions`，记录了客户的交易信息：

- `transaction_id`：交易ID
- `client_id`：客户ID
- `client_name`：客户姓名
- `stock_code`：股票代码
- `stock_name`：股票名称
- `transaction_type`：交易类型（买入/卖出）
- `quantity`：交易数量（股）
- `price`：交易价格（元）
- `transaction_date`：交易日期
- `sector`：行业板块

## 任务要求
风控团队需要一个复杂的风险评估报告，请你编写SQL查询：

1. 计算每个客户的总交易金额（买入+卖出）
2. 计算每个客户的交易频次（总交易次数）
3. 计算每个客户的平均单笔交易金额
4. 统计每个客户交易的不同股票数量（去重）
5. 计算每个客户的买卖比例（买入金额/总交易金额*100）
6. 使用窗口函数计算每个客户的交易金额在所有客户中的排名
7. 只显示总交易金额大于100000的客户
8. 按交易金额排名升序排列

返回字段：
- 客户姓名（client_name）
- 总交易金额（total_amount）
- 交易频次（transaction_count）
- 平均单笔金额（avg_amount，保留2位小数）
- 交易股票数（stock_count）
- 买入占比（buy_ratio，保留1位小数，加%符号）
- 交易金额排名（amount_rank）

## 提示
- 使用CASE WHEN区分买入卖出
- 使用窗口函数RANK()计算排名
- 使用COUNT DISTINCT统计不同股票
- 注意处理除零情况

这是一个综合性很强的查询，考验你的SQL综合能力！💼 